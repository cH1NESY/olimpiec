# Решение проблем с cloudflared

## Проблема: Файлы JS/CSS не загружаются (статус pending)

### Симптомы:
- В Network tab файлы показывают статус `(pending)`
- Белый/черный экран в браузере и Telegram Mini App
- Cloudflared зависает при загрузке больших файлов

### Причины:
1. **Cloudflared имеет проблемы с большими файлами** (>300KB)
2. **Таймауты cloudflared** для статических файлов
3. **Нестабильность бесплатного cloudflared** туннеля

### Решения:

#### 1. Разбиение на чанки (уже реализовано)

Файлы теперь разбиты на несколько частей:
- `react-vendor-*.js` (~162 KB)
- `telegram-vendor-*.js` (~36 KB)
- `index-*.js` (~113 KB)

Это должно помочь cloudflared лучше обрабатывать файлы.

#### 2. Использование ngrok (рекомендуется для разработки)

**Преимущества ngrok:**
- Более стабильная работа с большими файлами
- Лучшая производительность
- Возможность фиксированного URL (платная версия)

**Установка:**
```bash
# Скачайте ngrok с https://ngrok.com/download
# Или через пакетный менеджер
sudo apt install ngrok  # Ubuntu/Debian
```

**Запуск:**
```bash
ngrok http 5173
```

**Использование URL в @BotFather:**
- Скопируйте HTTPS URL из ngrok (например: `https://abc123.ngrok.io`)
- Используйте его в @BotFather вместо cloudflared URL

#### 3. Использование localtunnel (альтернатива)

**Установка:**
```bash
npm install -g localtunnel
```

**Запуск:**
```bash
lt --port 5173
```

#### 4. Настройка cloudflared с параметрами

Если хотите продолжить использовать cloudflared:

```bash
# Запуск с увеличенными таймаутами
./cloudflared tunnel --url http://localhost:5173 --no-tls-verify
```

#### 5. Развертывание на сервере (для продакшена)

Для продакшена рекомендуется:
- Использовать реальный сервер с доменом
- Настроить SSL сертификат (Let's Encrypt)
- Использовать CDN для статических файлов

### Проверка работы:

1. **Проверьте локально:**
   ```bash
   curl http://localhost:5173
   ```

2. **Проверьте через туннель:**
   ```bash
   curl https://your-tunnel-url.com
   ```

3. **Проверьте загрузку JS файлов:**
   ```bash
   curl -I https://your-tunnel-url.com/assets/index-*.js
   ```

4. **В браузере:**
   - Откройте DevTools (F12)
   - Перейдите на вкладку Network
   - Обновите страницу (Ctrl+R)
   - Проверьте, что все файлы загружаются со статусом 200

### Если проблема сохраняется:

1. **Попробуйте другой туннель сервис** (ngrok, localtunnel)
2. **Проверьте логи nginx:**
   ```bash
   docker compose logs frontend
   ```
3. **Проверьте, что фронтенд запущен:**
   ```bash
   docker compose ps frontend
   ```
4. **Перезапустите все сервисы:**
   ```bash
   docker compose restart frontend
   ```

### Рекомендации:

- **Для разработки:** Используйте ngrok или localtunnel
- **Для тестирования:** Cloudflared может работать, но нестабилен
- **Для продакшена:** Используйте реальный сервер с HTTPS
